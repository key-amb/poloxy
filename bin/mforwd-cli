#!/usr/bin/env ruby

require_relative '../lib/mforwd'
require_relative '../lib/mforwd/buffer'

param = {
  name:        'foo',
  kind:        :Yellow,
  group:       'Default',
  type:        :HttpPost,
  address:     'https://api.example.com/',
  message:     "Something went wrong!\nPlease check!\n",
  received_at: Time.now,
}
OptionParser.new do |opt|
  opt.on('-n', '--name=NAME')       { |n| param[:name]    = n}
  opt.on('-k', '--kind=KIND')       { |k| param[:kind]    = k}
  opt.on('-g', '--group=GROUP')     { |g| param[:group]   = g}
  opt.on('-t', '--type=TYPE')       { |t| param[:type]    = t}
  opt.on('-a', '--addr=ADDRESS')    { |a| param[:address] = a}
  opt.on('-m', '--message=MESSAGE') { |m| param[:message] = m}
  opt.parse! ARGV
end

MForwd::DataStore.new.connect

p param

item = MForwd::DataModel.new.spawn('Item', param)
item.save
MForwd::Buffer.new.push item.id
